{% extends "base.html" %}

{% block content %}
<div class="container statistics-page">
    <h1 class="page-title">Statistiche</h1>
    
    <!-- Statistics cards container -->
    <div class="statistics-grid">
        {% for stat in stats %}
        <!-- Statistic card -->
        <div class="statistic-card">
            <h2 class="statistic-title">{{ stat.title }}</h2>
            <div class="statistic-visual">
                {% if stat.visualization_type == 'chart' %}
                    <div id="chart-{{ stat.id }}" class="chart-container"></div>
                {% elif stat.visualization_type == 'query' %}
                    <div class="query-results">
                        {{ stat.query_html|safe }}
                    </div>
                {% endif %}
            </div>
            <p class="statistic-description">
                {{ stat.description }}
            </p>
            {% if stat.has_details %}
            <a href="{{ url_for('statistics.statistic_detail', stat_id=stat.id) }}" class="btn btn-secondary">Esplora i dati</a>
            {% endif %}
        </div>
        {% endfor %}
        
        <!-- If we have fewer than 3 statistics, show placeholder -->
        {% if stats|length < 3 %}
            {% for i in range(3 - stats|length) %}
            <div class="statistic-card coming-soon">
                <h2 class="statistic-title">Prossimamente...</h2>
                <div class="statistic-visual placeholder">
                    <!-- Placeholder icon or image -->
                </div>
                <p class="statistic-description">
                    Nuove statistiche in arrivo. Resta aggiornato!
                </p>
            </div>
            {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Add chart.js or your preferred visualization library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% for stat in stats %}
            {% if stat.visualization_type == 'chart' %}
                // Render chart for each statistic
                const ctx{{ stat.id }} = document.getElementById('chart-{{ stat.id }}').getContext('2d');
                const data{{ stat.id }} = {{ stat.chart_data|safe }};
                
                new Chart(ctx{{ stat.id }}, {
                    type: '{{ stat.chart_type }}',
                    data: data{{ stat.id }},
                    options: {{ stat.chart_options|safe }}
                });
            {% endif %}
        {% endfor %}
    });
</script>
{% endblock %}
